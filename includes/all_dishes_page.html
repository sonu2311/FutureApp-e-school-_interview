<!DOCTYPE html>
<html ng-app="myApp" ng-controller="common_ctrl" >
<head>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<link rel="stylesheet" href="main.css">
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
<script src="main.js"></script>
<style>	
div.hsplit:after {
content: "";big_div
clear: both;
display: table;
}

div.hsplit > div {
	float: left;
}
.pagination_button {
	border: solid #ccc 1px; padding:2px 9px; border-radius: 2px;
	outline: none;
	margin: 2px;
}
.pagination_button:hover{
	outline: none;
	border-radius: 2px;
	
}
.pagination_previous_button{
	border:solid #ccc 1px; 
	outline: none;
	width:100px; 
	border-radius: 2px;  
}
</style>
</head>
<body  ng-controller="myCtrl" >
	<div ng-include='"header.html"' ></div>
	<div class="hsplit" style=" ">
		<div style="margin-top:15px; margin-right: 23px;float: right;" >
			
			<select style=" outline: none; border-radius: 2px;background-color: rgb(10, 102, 194); padding:5px; cursor: pointer; font-size: 13px;color:#fff; border:solid rgb(10, 102, 194) 1px;" ng-model="self.sort_by" ng-change='reload()' >
				<option style="cursor: pointer;background-color: #fff; color:#222;" value="SORT_BY_RELEVENCE">Sort By Relevence</option>
				<option style="cursor: pointer;background-color: #fff; color:#222;" value="SORT_BY_PRICE_HIGH_TO_LOW">Price: High to Low</option>
				<option style="cursor: pointer;background-color: #fff; color:#222;" value="SORT_BY_PRICE_LOW_TO_HIGH">Price: Low to High</option>
			</select>

		</div>
		<div style="margin-top:15px; margin-right: 23px;float: right;" >
			
			<select style="background-color: rgb(10, 102, 194);color:#fff;border:solid rgb(10, 102, 194) 1px;  outline: none; border-radius: 2px; padding:5px; cursor: pointer; font-size: 13px;" ng-model="self.veg_nonveg" ng-change='reload()' >
				<option style="cursor: pointer; background-color: #fff; color:#222;" value="VEG_AND_NONVEG">Veg and Nonveg</option>
				<option style="cursor: pointer; background-color: #fff; color:#222;" value="VEG">Veg</option>
				<option style="cursor: pointer;background-color: #fff; color:#222;" value="NONVEG">Nonveg</option>
			</select>

		</div>
		<div style="margin-top:15px; margin-right: 23px;float: right;" >
			
			<select style="background-color: rgb(10, 102, 194);color:#fff;border:solid rgb(10, 102, 194) 1px;  outline: none; border-radius: 2px; padding:5px;cursor: pointer; font-size: 13px;" ng-model="self.menu_date" ng-change='reload()' >
				<option style="cursor: pointer;background-color: #fff; color:#222;" ng-repeat="x in upcoming_7days_date_list">{{x}}</option>
			</select>
		</div>
	</div>

	<div class="hsplit big_div" ng-if="list.length>0">
		<div ng-repeat="x in list" class="col-xs-12 col-sm-6 col-md-4 col-lg-3 box_sizing">
			<div class="border" style="">
				<a style="text-decoration: none;">
					<div style="height: 250px; text-align: center; overflow: hidden; vertical-align: middle; white-space: nowrap;" >
						<span style="vertical-align: middle;height: 100%; display: inline-block;visibility: hidden;" ></span>
						<img style="max-height: 250px; max-width: 100%; vertical-align: middle" ng-src="{{x.image}}" >
					</div>
				</a>
				<div  class="product_detail_div " style="margin-top: 20px;" >
					<div>
						<img src="https://www.pngkey.com/png/detail/261-2619381_chitr-veg-symbol-svg-veg-and-non-veg.png" style="width:12px;" ng-if="x.veg_nonveg =='VEG'">
						<img src="https://www.pngkey.com/png/detail/245-2459071_non-veg-icon-non-veg-symbol-png.png" style="width:12px;" ng-if="x.veg_nonveg =='NONVEG'">
						<span style="color: #333; font-weight:700;margin-left: 2px;">{{x.dish_name}}</span>
					</div>
					<div class="hsplit" style="">
						<div  class="price_in_product_detail" >
							<span style="font-size: 15px;">â‚¹</span> {{x.price}}</div>
						<div class=" add_cart" style="float:right;" ng-if='x.dish_quantity == 0' ng-click="add_dish_quantity(x)">Add To Cart</div>

						<div class="hsplit add_remove_comman_div" style="float:right; " ng-if="x.dish_quantity > 0" >
							<div >
								<span class="material-icons add_remove_class margin_right_5" ng-click="remove_dish_quantity(x)" >
								remove_circle_outline
								</span>
							</div>
							<div class="add_number">
								<span >{{x.dish_quantity}}</span>
							</div>
							<div >
								<span class="material-icons add_remove_class margin_left_5" ng-click="add_dish_quantity(x)" >
								add_circle_outline
								</span>
							</div>
						</div>		
					</div>
				</div>
			</div>
		</div>
	</div>

	<div style="height: 50px;" ng-if="list.length>0" ></div>
	<hr ng-if="list.length>0">
	<div class="hsplit" style=" box-sizing: border-box; margin-bottom: 10px; text-align: center;" ng-if="list.length>0">
		<div class="col-lg-3 col-md-3 col-sm-3 col-xs-1" style="box-sizing: border-box;"></div>
		<div class="col-lg-6 col-md-6 col-sm-6 col-xs-10" style=" padding-left: 0px; padding-right:0px;box-sizing: border-box; ">
			<div style="  display: inline-block; " >
				<a style="outline: none;"  href="all_dishes_page.html?search_key={{search_key}}&sort_by={{sort_by}}&menu_date={{menu_date}}&veg_nonveg={{veg_nonveg}}&page={{page-1}}">
					<button class="pagination_previous_button" style="" ng-disabled="page==1">
						<span class="material-icons" style="vertical-align: middle;font-size: 15px; color:#666;">
							fast_rewind
						</span>
						previous
					</button>
				</a>
			</div>
			<div style="display: inline-block;">
				<div style="display: inline-block;" ng-repeat='x in page_number_list'>
					<div>
						<a style="outline: none;"  href="all_dishes_page.html?search_key={{search_key}}&sort_by={{sort_by}}&menu_date={{menu_date}}&veg_nonveg={{veg_nonveg}}&page={{x.page}}" ng-if="x.page!=0"><button class="pagination_button" ng-style='{"background-color": x.page == page ? "rgb(10, 102, 194)": "#ddd","color":x.page == page ?"#fff":"#222"}'>{{x.page}}</button>
						</a>
					</div>
					<div ng-if="x.page==0" style="margin: 1px;">...</div>
				</div>
			</div>
			<div style="display: inline-block; margin-left:6px;" >
				<a style="outline: none;"  href="all_dishes_page.html?search_key={{search_key}}&sort_by={{sort_by}}&menu_date={{menu_date}}&veg_nonveg={{veg_nonveg}}&page={{1+page}}">
					<button style="border:solid #ccc 1px; outline:none; padding:2px 25px; border-radius: 2px; " ng-disabled="page>=page_count">
						next
						<span class="material-icons" style="vertical-align: middle;font-size: 15px;color:#666;">
							fast_forward
						</span>
					</button>
				</a>
			</div>
		</div>
		<div class="col-lg-3 col-md-3 col-sm-3 col-xs-1" style="box-sizing: border-box;"></div>
	</div>
	<hr ng-if="list.length>0">
	<div style="height: 100px;" ng-if="list.length>0" ></div>

	<div ng-if="list.length <= 0" style="margin-top:100px; margin-left: 80px;">
		<img style='max-height:400px; max-width: 80%;' src="images/search_no_result.png">
	</div>

<script>
app.controller('myCtrl', function($scope,$http) {
	$scope.self = $scope
	// c=present time page number
	// n=total page  number
	var button_list=function(c,n) {
		var l=[]
		var i=1
		while(i <=n){
			if(i== 1 || i==n || Math.abs(c-i)<=1){
				l.push({page: i})
			}
			else {
				// list ka jo last elemnet me "page" key ke corsponding value 0 na ho to hm  {"page":0} push kr dete h.
				if(l[l.length-1].page!=0){
					l.push({page: 0})
				}
			}
			i+=1
		}
		return l
		
	}
	var url_params = new URLSearchParams((new URL(window.location.href)).search)
	$scope.sort_by = url_params.get("sort_by") || "SORT_BY_RELEVENCE"
	$scope.search_key = url_params.get("search_key") || ""
	$scope.page = parseInt(url_params.get("page") || '1')
	$scope.menu_date = url_params.get("menu_date") || ""
	$scope.veg_nonveg = url_params.get("veg_nonveg") || "VEG_AND_NONVEG"
	// products or cart ki jo join table h vo yha return me milegi to vhi hme ng-repeat me use krni h.
	$scope.page_loading = true
	$scope.load_all_dishes = function() {
		api($http,'/all_dishes', {"search_key":$scope.search_key,"sort_by":$scope.sort_by, "page": $scope.page,"menu_date":$scope.menu_date,"veg_nonveg": $scope.veg_nonveg}, function(backend_output) {
			$scope.page_loading = false
			$scope.list = backend_output.dish_list
			$scope.page_count = backend_output.num_page
			$scope.upcoming_7days_date_list = backend_output.upcoming_7days_date_list
			$scope.page_number_list = button_list($scope.page, $scope.page_count)
			if ($scope.menu_date == "") {
				$scope.menu_date = backend_output.upcoming_7days_date_list[0]
			}
		})
	}
	$scope.load_all_dishes()

	$scope.reload = function() {
		window.location.href = "all_dishes_page.html?search_key=" + $scope.search_key + "&sort_by=" + $scope.sort_by + "&menu_date=" + $scope.menu_date + "&veg_nonveg=" + $scope.veg_nonveg
	}

// products page me hm bina login kiye saman add ni kr skte isliye phle yha ye check krna h ki user ne login kiya h ki ni kiya age login kiya h to api work kre ni to alert aa jaye ki login ni h.
	$scope.add_dish_quantity=function(p) {
		if(Is_login()){
			var new_dish_quantity = p.dish_quantity+1
			api($http, '/add_dish_quantity',{"dish_id": p.id, "cook_id":p.cook_id, "dish_quantity": new_dish_quantity, "menu_date":$scope.menu_date},function(backend_output){
				if ('error' in backend_output) {
					$scope.my_alert(backend_output.error)
				} else {
					p.dish_quantity = new_dish_quantity
				}
			})	
		}
		else{
			$scope.my_alert("cart me add krne ke liye login krna hoga")
		}	
	}
// isme bi same hi api use hogi kyuki quantitis hi update krni h.
	$scope.remove_dish_quantity=function(p){
		p.dish_quantity -= 1
		api($http, '/add_dish_quantity',{"dish_id": p.id, "cook_id":p.cook_id, "dish_quantity": p.dish_quantity, "menu_date":$scope.menu_date},function(backend_output){})
	}



});
</script>
</body>
</html>